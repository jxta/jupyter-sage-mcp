#!/bin/bash

echo "ğŸ”§ Setting up SageMath MCP environment..."

# SageMathã‚«ãƒ¼ãƒãƒ«ã®ç™»éŒ²
echo "ğŸ“š Installing SageMath kernel..."
sage -python -m sage_setup.jupyter.install --user

# ã‚«ãƒ¼ãƒãƒ«ç¢ºèª
echo "ğŸ” Checking available kernels..."
jupyter kernelspec list

# Jupyterè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
echo "âš™ï¸ Creating Jupyter configuration..."
mkdir -p ~/.jupyter

# Jupyter Serverè¨­å®š
cat > ~/.jupyter/jupyter_server_config.py << 'EOF'
c.ServerApp.allow_origin = '*'
c.ServerApp.disable_check_xsrf = True
c.ServerApp.token = 'binder_mcp_token'
c.ServerApp.password = ''
c.ServerApp.open_browser = False
c.ServerApp.port = 8888
c.ServerApp.ip = '0.0.0.0'

# MCPç”¨ã®è¨­å®š
c.ServerApp.allow_remote_access = True
c.ServerApp.trust_xheaders = True
EOF

# JupyterLabè¨­å®š
cat > ~/.jupyter/jupyter_lab_config.py << 'EOF'
c.LabApp.check_for_updates_class = "jupyterlab.NeverCheckForUpdate"
c.ExtensionApp.open_browser = False
EOF

# MCPç”¨ã®Pythonç’°å¢ƒç¢ºèª
echo "ğŸ Checking Python environment..."
python -c "
import sys
print(f'Python: {sys.version}')

try:
    import sage.all
    print('âœ… SageMath available')
except ImportError:
    print('âŒ SageMath not available')

try:
    import jupyter_client
    print('âœ… Jupyter client available')
except ImportError:
    print('âŒ Jupyter client not available')

try:
    import websockets
    print('âœ… WebSockets available')
except ImportError:
    print('âŒ WebSockets not available')
"

# srcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’Pythonãƒ‘ã‚¹ã«è¿½åŠ 
echo "ğŸ“ Setting up Python path..."
mkdir -p ~/.ipython/profile_default/startup/
echo "import sys; sys.path.append('/home/jovyan/src')" > ~/.ipython/profile_default/startup/00-setup-path.py

# MCPãƒ‡ãƒ¢ãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™
echo "ğŸ“ Preparing demo files..."
mkdir -p /home/jovyan/notebooks
mkdir -p /home/jovyan/src
mkdir -p /home/jovyan/config

echo "âœ… SageMath MCP environment setup complete!"
echo "ğŸš€ Ready to start Jupyter with SageMath and MCP support"
